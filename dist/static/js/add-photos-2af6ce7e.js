import{d as q,u as k}from"./vue-router-0b23dc16.js";import{b as I,i as S}from"./site-c95c3361.js";import{e as B}from"./photo-6b81e8a6.js";import{U as R}from"./upload-9e7cdaea.js";import{aO as L,bA as _}from"./auth-0313e5d1.js";import{E as f}from"./index-3c2da9f0.js";import{h as A,r as h,o as V,v as z,x as u,a3 as x,j as D,l as o,C as E,D as v,B as y,u as w,ba as M,b9 as j}from"./runtime-core.esm-bundler-185e3605.js";import{_ as O}from"./_plugin-vue_export-helper-c27b6911.js";const T=s=>(M("data-v-d918af1d"),s=s(),j(),s),$={class:"flex_r_b"},F={style:{"font-weight":"600",color:"#606266"}},G=T(()=>o("div",{class:"flex_r_b mt-[10px] tips"},[o("span"),y(" tips: 最多上传9张照片，并且总大小不能超过30M ")],-1)),H={class:"album-upload"},J=A({__name:"add-photos",setup(s){const a=q(),b=k(),l=h(null),t=h(null),d=h([]),N=async()=>{if(!t.value){_("请重新选择相册上传图片",{type:"error"});return}const p=[],i=f.service({fullscreen:!0,text:"图片压缩中"}),n=d.value.map(async e=>await I(e.raw)),r=[];await Promise.all(n).then(e=>{e.map(c=>{r.push({raw:c})})}),i.close();const m=f.service({fullscreen:!0,text:"努力上传中，请耐心等待......"}),C=r.map(async e=>await S(e));await Promise.all(C).then(e=>{e.map(c=>{if(c.code==0){const{url:U}=c.result;p.push({album_id:t.value,url:U})}else _("图片上传失败",{type:"error"})})}),m.close();const g=f.service({fullscreen:!0,text:"图片保存中......"});(await B({photoList:p})).code==0?_("保存成功",{type:"success"}):g.close(),g.close(),b.push({path:"/photo/photoList",query:{id:t.value,albumName:l.value}})},P=()=>{b.push({path:"/photo/photoList",query:{id:t.value,albumName:l.value}})};return V(()=>{a.query.id&&a.query.albumName&&(l.value=a.query.albumName,t.value=a.query.id)}),(p,i)=>{const n=x("el-button"),r=x("el-card");return D(),z(r,null,{header:u(()=>[o("div",$,[o("span",F,"图库名称 - "+E(l.value),1),o("div",null,[v(n,{type:"danger",size:"small",icon:w(L),onClick:N},{default:u(()=>[y("保存")]),_:1},8,["icon"]),v(n,{type:"info",size:"small",icon:w(L),onClick:P},{default:u(()=>[y("取消")]),_:1},8,["icon"])])]),G]),default:u(()=>[o("div",H,[v(R,{fileList:d.value,"onUpdate:fileList":i[0]||(i[0]=m=>d.value=m),limit:9,width:108,height:108,multiple:!0,preview:!1},null,8,["fileList"])])]),_:1})}}});const se=O(J,[["__scopeId","data-v-d918af1d"]]);export{se as default};
