import{bA as f,bG as V}from"./auth-0313e5d1.js";import{d as h,u as q}from"./vue-router-0b23dc16.js";import{U as C}from"./upload-9e7cdaea.js";import{b as B,e as j,c as R}from"./talk-7b8b6a27.js";import{b as T,i as z}from"./site-c95c3361.js";import{E as k}from"./index-3c2da9f0.js";import{h as D,J as E,o as N,v as P,x as a,a3 as r,j as O,l as w,B as g,C as S,u as A,D as o}from"./runtime-core.esm-bundler-185e3605.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";const H={class:"flex justify-between items-center"},J=D({__name:"index",setup(M){const i=h(),y=q(),e=E({id:null,content:"",is_top:2,status:1,talkImgList:[],user_id:0}),x=async()=>{var u;if(e.content||e.talkImgList.length>0){let t=[];const n=[];i.query.id?(t=e.talkImgList.filter(s=>!s.id),e.talkImgList.forEach(s=>{s.id&&n.push({id:s.id,url:s.url})})):t=e.talkImgList;const p=k.service({fullscreen:!0,text:"图片压缩中"}),d=t.map(async s=>await T(s.raw)),c=[];await Promise.all(d).then(s=>{s.map(l=>{c.push({raw:l})})}),p.close();const m=k.service({fullscreen:!0,text:"努力上传中，请耐心等待......"}),_=c.map(async s=>await z(s));if(await Promise.all(_).then(s=>{s.map(l=>{if(l.code==0){const{url:b}=l.result,U=i.query.id?{id:i.query.id,url:b}:{url:b};n.push(U)}else f("图片上传失败",{type:"error"})})}),m.close(),e.talkImgList=n,!i.query.id){const s=(u=V())==null?void 0:u.getUserId;Object.assign(e,{user_id:s})}(i.query.id?await j(e):await R(e)).code==0&&(f(i.query.id?"修改成功":"发布成功",{type:"success"}),y.go(-1))}else f("说说图片或说说内容不能都为空",{type:"warning"})},L=()=>{y.go(-1)},I=async u=>{const t=await B(u);t.code==0&&(t.result.talkImgList=t.result.talkImgList.map(n=>({id:u,url:n})),Object.assign(e,t.result))};return N(()=>{i.query.id&&I(i.query.id)}),(u,t)=>{const n=r("el-button"),p=r("el-input"),d=r("el-form-item"),c=r("el-switch"),m=r("el-option"),_=r("el-select"),v=r("el-form"),s=r("el-card");return O(),P(s,{class:"talk-card"},{header:a(()=>[w("div",H,[g(S(A(i).query.id?"编辑说说":"新增说说")+" ",1),w("div",null,[o(n,{type:"info",size:"small",onClick:L},{default:a(()=>[g("取消")]),_:1}),o(n,{type:"danger",size:"small",onClick:x},{default:a(()=>[g("保存")]),_:1})])])]),default:a(()=>[o(v,{ref:"formRef",model:e,"label-width":"60px","label-suffix":":"},{default:a(()=>[o(d,{label:"内容"},{default:a(()=>[o(p,{type:"textarea",modelValue:e.content,"onUpdate:modelValue":t[0]||(t[0]=l=>e.content=l),clearable:"",class:"max-w-[300px]",autosize:{minRows:4,maxRows:8}},null,8,["modelValue"])]),_:1}),o(d,{label:"图片",class:"img-form"},{default:a(()=>[o(C,{fileList:e.talkImgList,"onUpdate:fileList":t[1]||(t[1]=l=>e.talkImgList=l),width:80,height:80,limit:9,multiple:!0,preview:!1},null,8,["fileList"])]),_:1}),o(d,{label:"置顶"},{default:a(()=>[o(c,{modelValue:e.is_top,"onUpdate:modelValue":t[2]||(t[2]=l=>e.is_top=l),"active-value":1,"inactive-value":2},null,8,["modelValue"])]),_:1}),o(d,{label:"状态"},{default:a(()=>[o(_,{modelValue:e.status,"onUpdate:modelValue":t[3]||(t[3]=l=>e.status=l),class:"w-[120px]"},{default:a(()=>[o(m,{label:"公开",value:1}),o(m,{label:"私密",value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})}}});const ee=G(J,[["__scopeId","data-v-42db125d"]]);export{ee as default};
