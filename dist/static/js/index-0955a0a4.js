import{u as ae}from"./useNav-6f64178a.js";import{j as l,k as w,l as i,h as G,r as p,a as j,o as X,I as F,C as y,u,m as oe,A as T,q as le,J as ce,v as h,x as o,B as k,D as d,X as q,F as D,a3 as g,n as ie}from"./runtime-core.esm-bundler-185e3605.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import{u as re}from"./hooks-e73aa1dd.js";import{u as ue}from"./vue-router-0b23dc16.js";import{ak as de,bA as R}from"./auth-0313e5d1.js";import{g as _e,t as pe,a as fe,r as me,d as ve}from"./talk-7b8b6a27.js";import{E as H,a as J}from"./index-48093bc0.js";import{J as he}from"./index-efb1c453.js";import"./mitt-7f99bbc0.js";import"./app-c0ae8c6f.js";import"./index-6d140db2.js";const ge={class:"icon",width:"200",height:"200",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},xe=i("path",{fill:"#f4ea2a",d:"M927.701 375.979 648.064 96.34a37.547 37.547 0 0 0-26.667-11.008 37.547 37.547 0 0 0-26.666 11.008L411.904 279.296a366.507 366.507 0 0 0-41.77-2.304 374.016 374.016 0 0 0-234.326 82.048 37.717 37.717 0 0 0-3.072 56.064l206.208 206.208-244.48 244.224a17.92 17.92 0 0 0-5.205 11.093l-3.84 42.24a18.09 18.09 0 0 0 18.048 19.755c.554 0 1.109 0 1.706-.128l42.24-3.84a17.92 17.92 0 0 0 11.094-5.248l244.437-244.437 206.208 206.208a37.547 37.547 0 0 0 26.667 11.008 37.547 37.547 0 0 0 29.397-14.08 374.827 374.827 0 0 0 79.659-276.224L927.7 429.056a37.59 37.59 0 0 0 0-53.077zM686.976 554.325 659.2 582.144l4.267 39.04a294.997 294.997 0 0 1-34.475 174.677L228.309 394.923a293.547 293.547 0 0 1 174.635-34.518l39.04 4.31 27.819-27.776 151.722-151.723 217.302 217.301-151.851 151.851z"},null,-1),ye=[xe];function we($,n){return l(),w("svg",ge,ye)}const be={render:we},ke=G({__name:"index",props:{text:{type:String,default:""},maxLines:{type:Number,default:3},width:{type:Number,default:0},fontSize:{type:Number,default:14}},setup($){const n=$,L=p(!1),C=p(!1),f=p(null),_=p(null),x=p(null),m=p(n.width),I=p(0),B=p(n.width),v=j(()=>{if(n.width)return{width:n.width+"px",fontSize:n.fontSize+"px"}}),E=j(()=>{const a=m.value*n.maxLines<n.text.length*n.fontSize+n.fontSize;let r=n.text;return a&&!L.value&&(r=n.text.slice(0,m.value)+"..."),r});function S(a,r){F(()=>{Math.abs(a-r)<=1||(O()?r=m.value:a=m.value,m.value=Math.floor((a+r)/2),S(a,r))})}function O(){const{len:a,lastWidth:r}=M();if(a<n.maxLines)return!1;if(n.maxLines){const V=a===n.maxLines&&r+I.value>B.value;if(a>n.maxLines||V)return!0}return!1}function M(){const a=x.value.getClientRects();return{len:a.length,lastWidth:a[a.length-1].width}}function A(){L.value=!L.value}return X(()=>{const{len:a}=M();a>n.maxLines&&(C.value=!0,F(()=>{I.value=_.value.clientWidth,B.value=f.value.clientWidth,S(0,n.text.length)}))}),(a,r)=>(l(),w("div",{ref_key:"textOverflowRef",ref:f,style:le(u(v))},[i("span",{class:"keep",ref_key:"overEllipsisRef",ref:x},y(u(E)),513),C.value?(l(),w("span",{key:0,class:"slot-box",ref_key:"slotRef",ref:_},[oe(a.$slots,"default",{clickToggle:A,expanded:L.value},void 0,!0)],512)):T("",!0)],4))}});const Te=K(ke,[["__scopeId","data-v-ca9a0e26"]]),Le={width:1024,height:1024,body:'<path fill="currentColor" d="M480 480V128a32 32 0 0 1 64 0v352h352a32 32 0 1 1 0 64H544v352a32 32 0 1 1-64 0V544H128a32 32 0 0 1 0-64h352z"/>'},ze={class:"flex justify-between items-center"},Ce={class:"talk-parent"},Ie={class:"flex justify-between items-center"},Be={class:"el-dropdown-link"},Se={class:"talk-header"},Me={class:"talk-header__right"},Ne={class:"nick-name"},Re=["onClick"],$e={key:0,class:"talk-img"},Ee={key:1,class:"talk-img-one"},Oe={class:"time"},Ae={class:"observer"},Ve=G({__name:"index",setup($){const n=ue(),{avatar:L,nickName:C}=ae(),f=ce({current:1,size:5,status:1}),_=p([]),x=p(0);let m;const I=[{key:1,content:"公开说说",title:"公开说说"},{key:2,content:"私密说说",title:"私密说说"},{key:3,content:"回收站",title:"回收站"}],B=async s=>{f.status=s.index?Number(s.index)+1:null,f.current=1,await v(),_.value.length<x.value&&P()},v=async s=>{const e=await _e(f);e.code==0&&(_.value=f.current==1?e.result.list:_.value.concat(e.result.list),x.value=e.result.total,s&&_.value.length>=x.value&&m.unobserve(s.target))},E=async(s,e)=>{(await pe(s,e==1?2:1)).code==0&&(R(`${e==1?"隐藏":"公开"}说说成功`,{type:"success"}),v())},S=async(s,e)=>{(await fe(s,e==1?2:1)).code==0&&(R(`${e==1?"取消置顶":"置顶"}成功`,{type:"success"}),v())},O=async s=>{(await me(s)).code==0&&(R("恢复成功",{type:"success"}),v())},M=async(s,e)=>{(await ve(s,e)).code==0&&(R(`${e==3?"彻底删除成功":"说说已进入回收站"}`,{type:"success"}),f.current=1,v())},A=async(s,e)=>{switch(s){case"toggleTop":S(e.id,e.is_top);break;case"togglePublic":E(e.id,e.status);break;case"revert":O(e.id);break;case"edit":r(e.id);break;case"delete":he.confirm(`${e.status==3?"确认删除":"确认回收"}`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then(()=>{M(e.id,e.status)});break}},a=()=>{n.push("/talk/addTalk")},r=s=>{n.push({path:"/talk/editTalk",query:{id:s}})},V=s=>{s=s.replace(/-/g,"/");const e=new Date().getTime()-new Date(s).getTime();let c;return e<6e4?c=Math.trunc(e/1e3)+"秒":e>=6e4&&e<36e5?c=Math.trunc(e/6e4)+"分钟":e>=36e5&&e<864e5?c=Math.trunc(e/36e5)+"小时":c=Math.trunc(e/864e5)+"天",c},P=()=>{const s=document.querySelector(".observer");m=new IntersectionObserver(e=>{e.forEach(async c=>{c.isIntersecting&&c.intersectionRatio>0&&(f.current++,v(c))})},{threshold:[1]}),m.observe(s)};return X(async()=>{await v(),_.value.length<x.value&&P()}),(s,e)=>{const c=g("el-button"),Q=g("el-tooltip"),U=g("el-tab-pane"),Y=g("el-tabs"),Z=g("el-icon"),z=g("el-dropdown-item"),ee=g("el-dropdown-menu"),te=g("el-dropdown"),se=g("el-avatar");return l(),h(u(H),{class:"talk-card"},{header:o(()=>[i("div",ze,[k(" 说说列表 "),d(c,{type:"danger",size:"small",icon:u(re)(u(Le)),onClick:a},{default:o(()=>[k(" 发布说说 ")]),_:1},8,["icon"])])]),default:o(()=>[d(Y,{onTabClick:B},{default:o(()=>[(l(),w(D,null,q(I,t=>d(U,{key:t.key,lazy:!0},{label:o(()=>[d(Q,{content:t.content,placement:"top-end"},{default:o(()=>[i("span",null,y(t.title),1)]),_:2},1032,["content"])]),_:2},1024)),64))]),_:1}),i("div",Ce,[(l(!0),w(D,null,q(_.value,(t,W)=>(l(),h(u(H),{class:ie([W?"mt-[20px]":"","w-[384px]","talk-list"]),key:t.id},{header:o(()=>[i("div",Ie,[i("div",null,[t.status==1&&t.is_top==1?(l(),h(u(be),{key:0,class:"zhiding"})):T("",!0)]),d(te,{onCommand:b=>{A(b,t)}},{dropdown:o(()=>[d(ee,null,{default:o(()=>[[1,2].includes(t.status)?(l(),h(z,{key:0,command:"edit"},{default:o(()=>[k("编辑")]),_:1})):T("",!0),t.status==1?(l(),h(z,{key:1,command:"toggleTop"},{default:o(()=>[k(y(t.is_top==1?"取消置顶":"置顶"),1)]),_:2},1024)):T("",!0),[1,2].includes(t.status)?(l(),h(z,{key:2,command:"togglePublic"},{default:o(()=>[k(y(t.status==1?"隐藏":"公开"),1)]),_:2},1024)):T("",!0),t.status==3?(l(),h(z,{key:3,command:"revert"},{default:o(()=>[k("恢复说说")]),_:1})):T("",!0),d(z,{command:"delete"},{default:o(()=>[k("删除")]),_:1})]),_:2},1024)]),default:o(()=>[i("span",Be,[d(Z,{class:"el-icon--right"},{default:o(()=>[d(u(de))]),_:1})])]),_:2},1032,["onCommand"])])]),default:o(()=>[i("div",Se,[d(se,{class:"talk-header__left",size:40,src:t.avatar||u(L),shape:"square"},null,8,["src"]),i("div",Me,[i("span",Ne,y(t.nick_name||u(C)),1),d(Te,{class:"mt-[5px]",text:t.content,width:299,maxLines:8,"font-size":13},{default:o(({clickToggle:b,expanded:N})=>[i("button",{onClick:b,class:"btn"},y(N?"收起":"展开"),9,Re)]),_:2},1032,["text"])])]),Array.isArray(t.talkImgList)&&t.talkImgList.length>1?(l(),w("div",$e,[(l(!0),w(D,null,q(t.talkImgList,(b,N)=>(l(),h(u(J),{key:N,src:b,class:"w-[100px] h-[100px]",loading:"lazy","preview-teleported":"","initial-index":N,fit:"cover","preview-src-list":t.talkImgList.map(ne=>ne)},null,8,["src","initial-index","preview-src-list"]))),128))])):Array.isArray(t.talkImgList)&&t.talkImgList.length==1?(l(),w("div",Ee,[(l(),h(u(J),{key:W,src:t.talkImgList[0],class:"w-[120px] h-[120px]",loading:"lazy","preview-teleported":"","initial-index":W,fit:"cover","preview-src-list":t.talkImgList.map(b=>b)},null,8,["src","initial-index","preview-src-list"]))])):T("",!0),i("div",Oe,y(V(t.createdAt))+"前",1)]),_:2},1032,["class"]))),128)),i("div",Ae,y(_.value.length>=x.value?"暂无更多":"下拉加载更多"),1)])]),_:1})}}});const Ue=K(Ve,[["__scopeId","data-v-c41f313f"]]);export{Ue as default};
