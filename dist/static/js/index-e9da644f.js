import{u as M}from"./vue-router-0b23dc16.js";import{aF as X,bA as F,bO as H,c9 as K,ca as P,b6 as Q}from"./auth-0313e5d1.js";import{U as W}from"./upload-9e7cdaea.js";import{g as Y,u as Z,a as ee,d as te}from"./photo-6b81e8a6.js";import{i as ae}from"./site-c95c3361.js";import{E as le}from"./index-3c2da9f0.js";import{h as oe,r as f,J as b,o as se,v as U,x as o,a3 as n,j as C,l as c,B as g,D as l,u as v,k as ne,X as re,F as ie,C as A}from"./runtime-core.esm-bundler-185e3605.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";const ce={class:"flex_r_b"},de={class:"album-card"},me={class:"flex_r_b pad5"},pe={class:"album-title"},_e=["title"],fe={class:"operate flex_r_b"},be=["title"],ge=oe({__name:"index",setup(ve){const $=(s,e,r)=>{if(!a.coverList.length)return new Error("请上传相册封面");r()},B=M(),k=f([]),z=f(0),u=b({current:1,size:8,album_name:""}),d=f(!1),x=f(),a=b({id:"",album_name:"",description:"",album_cover:"",coverList:[]}),R=b({...a}),j=b({album_name:{required:!0,message:"请输入相册名称",trigger:["blur"]},description:{required:!0,message:"请输入相册描述",trigger:["blur"]},album_cover:{required:!0,validator:$,trigger:["change"]}}),L=()=>{x.value.resetFields(),Object.assign(a,R),d.value=!1},q=async s=>{s&&await s.validate(async e=>{if(e){if(a.coverList[0].id)a.album_cover=a.coverList[0].url;else{const i=le.service({fullscreen:!0,text:"图片上传中"}),_=await ae(a.coverList[0]);if(_.code==0){const{url:y}=_.result;a.album_cover=y}i.close()}let r;a.id?r=await Z(a):r=await ee(a),r.code==0&&(await m(),F(`${a.id?"修改":"新增"}成功`,{type:"success"}),s.resetFields(),d.value=!1)}})},N=s=>{u.size=s,m()},D=s=>{u.current=s,m()},p=(s,e)=>{switch(s){case"edit":Object.assign(a,H(e)),d.value=!0;break;case"delete":I(e);break;case"photos":B.push({path:"/photo/photoList",query:{id:e.id,albumName:e.album_name}});break;case"add":d.value=!0;break;default:return}},I=async s=>{(await te(s)).code==0&&(m(),F("删除成功",{type:"success"}))},m=async()=>{const s=await Y(u);if(s.code==0){const{list:e,total:r}=s.result;k.value=e.map(i=>({id:i.id,album_name:i.album_name,description:i.description,album_cover:i.album_cover,coverList:[{id:1,url:i.album_cover}]})),z.value=r}};return se(()=>{m()}),(s,e)=>{const r=n("el-button"),i=n("el-icon"),_=n("el-popconfirm"),y=n("el-image"),O=n("el-col"),S=n("el-row"),E=n("el-pagination"),h=n("el-input"),w=n("el-form-item"),T=n("el-form"),G=n("el-dialog"),J=n("el-card");return C(),U(J,null,{header:o(()=>[c("div",ce,[g(" 相册管理 "),l(r,{type:"primary",icon:v(X),size:"small",onClick:e[0]||(e[0]=t=>p("add"))},{default:o(()=>[g("新增")]),_:1},8,["icon"])])]),default:o(()=>[l(S,{class:"album"},{default:o(()=>[(C(!0),ne(ie,null,re(k.value,t=>(C(),U(O,{style:{padding:"10px"},xs:24,sm:12,md:6,key:t.id},{default:o(()=>[c("div",de,[c("div",me,[c("div",pe,[c("span",{title:t.album_name},A(t.album_name),9,_e)]),c("div",fe,[l(i,{class:"mr-[5px]",color:"#67c23a",size:"18",onClick:V=>p("photos",t)},{default:o(()=>[l(v(K))]),_:2},1032,["onClick"]),l(i,{color:"#66b1ff",size:"18",onClick:V=>p("edit",t)},{default:o(()=>[l(v(P))]),_:2},1032,["onClick"]),l(_,{title:`删除相册-${t.album_name}?`,"icon-color":"#66b1ff",onConfirm:V=>p("delete",t.id)},{reference:o(()=>[l(i,{color:"#f56c6c",size:"16",style:{"margin-left":"5px"}},{default:o(()=>[l(v(Q))]),_:1})]),_:2},1032,["title","onConfirm"])])]),c("span",{title:t.desc,class:"album-desc"},A(t.description),9,be),l(y,{class:"album-image animate__animated animate__fadeIn",src:t.album_cover,fit:"cover",loading:"lazy","preview-teleported":"","preview-src-list":[t.album_cover]},null,8,["src","preview-src-list"])])]),_:2},1024))),128))]),_:1}),l(E,{class:"pagination","current-page":u.current,"onUpdate:current-page":e[1]||(e[1]=t=>u.current=t),"page-size":u.size,"onUpdate:page-size":e[2]||(e[2]=t=>u.size=t),"page-sizes":[8,12,16],small:!0,disabled:!1,background:!1,layout:"total, sizes, prev, pager, next, jumper",total:z.value,onSizeChange:N,onCurrentChange:D},null,8,["current-page","page-size","total"]),l(G,{title:a.id?"编辑相册":"新增相册",modelValue:d.value,"onUpdate:modelValue":e[8]||(e[8]=t=>d.value=t),width:400,"before-close":L},{footer:o(()=>[l(r,{size:"small",onClick:e[6]||(e[6]=t=>L())},{default:o(()=>[g("取消")]),_:1}),l(r,{size:"small",type:"danger",plain:"",onClick:e[7]||(e[7]=t=>q(x.value))},{default:o(()=>[g(" 保存 ")]),_:1})]),default:o(()=>[l(T,{ref_key:"albumFormRef",ref:x,inline:!0,model:a,rules:j,class:"bg-bg_color w-[99/100]","label-width":"100"},{default:o(()=>[l(w,{class:"form-item80",label:"相册名称",prop:"album_name"},{default:o(()=>[l(h,{modelValue:a.album_name,"onUpdate:modelValue":e[3]||(e[3]=t=>a.album_name=t),placeholder:"请输入相册名称",clearable:"",maxlength:"25"},null,8,["modelValue"])]),_:1}),l(w,{class:"form-item80",label:"相册描述",prop:"description"},{default:o(()=>[l(h,{type:"textarea",modelValue:a.description,"onUpdate:modelValue":e[4]||(e[4]=t=>a.description=t),placeholder:"请输入相册描述",clearable:"",maxlength:"25"},null,8,["modelValue"])]),_:1}),l(w,{class:"cover",label:"封面",prop:"album_cover"},{default:o(()=>[l(W,{fileList:a.coverList,"onUpdate:fileList":e[5]||(e[5]=t=>a.coverList=t),width:200,height:200,limit:1},null,8,["fileList"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])]),_:1})}}});const Ve=ue(ge,[["__scopeId","data-v-fb00728b"]]);export{Ve as default};
