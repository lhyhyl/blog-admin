import{bo as q,bA as V}from"./auth-0313e5d1.js";import{u as ce}from"./static-bddd7a0c.js";import{i as ue}from"./site-c95c3361.js";import{J as Y}from"./index-efb1c453.js";import{E as de}from"./index-3c2da9f0.js";import{J as k,r as z,o as pe,h as me,v as $,x as t,a3 as r,j as B,D as a,u as e,e as X,B as d,A as G,k as fe,X as _e,F as ge,C as E,l as Z,ba as be,b9 as he}from"./runtime-core.esm-bundler-185e3605.js";import{u as w}from"./hooks-e73aa1dd.js";import{d as ve}from"./search-cc37b371.js";import{d as ke}from"./refresh-04c5340d.js";import{d as ye}from"./delete-2f3d40d2.js";import{d as Ce}from"./edit-pen-37b5ced2.js";import{U as Le}from"./upload-9e7cdaea.js";import{_ as xe}from"./_plugin-vue_export-helper-c27b6911.js";import"./vue-router-0b23dc16.js";import"./index-6d140db2.js";const Ve=s=>q.request("post","/api/links/getLinksList",{data:s}),we=s=>q.request("post","/api/links/backUpdate",{data:s}),K=s=>q.request("put","/api/links/approve",{data:s}),ze=s=>q.request("put","/api/links/delete",{data:s}),Se=(s,b,c)=>{if(b){if(b.indexOf("http")==-1)return c(new Error("请输入带http://或https://的网站地址"));c()}else return c(new Error("请输入网站地址"))};function Be(){const s=k({current:1,size:10,time:"",status:"",site_name:""}),b=ce().linksTab,c=k({...s}),y=z(!1),_=z([]),h=z(!1),A=z("small"),v=z([]),C=[{type:"selection",align:"left",width:30},{label:"序号",type:"index",width:55},{label:"网站头像",prop:"site_avatar",slot:"site_avatar",width:80},{label:"网站名称",prop:"site_name"},{label:"网站描述",prop:"site_desc"},{label:"网站地址",prop:"url"},{label:"状态",prop:"status",slot:"status"},{label:"申请日期",prop:"createdAt"},{label:"通过日期",prop:"updatedAt"},{label:"操作",fixed:"right",minWidth:120,slot:"operation"}],i=k({id:"",site_name:"",site_desc:"",url:"",site_avatar:"",avatarList:[]}),T=k({...i}),D=k({site_name:[{required:!0,message:"请输入网站名称",trigger:"blur"}],site_desc:[{required:!0,message:"请输入网站描述",trigger:"blur"}],url:[{required:!0,validator:Se,trigger:"blur"}]}),L=k({pageSize:10,currentPage:1,pageSizes:[10,15,20],total:0,align:"right",background:!0,small:!0}),S=k({text:"正在加载第1页...",viewBox:"-10, -10, 50, 50",spinner:`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `});function U(){u()}const O=()=>{Object.assign(s,c),U()},M=l=>{l&&l.resetFields()};function j(l){v.value=l}function I(l){s.size=l,u()}function N(l){s.status=l.index?Number(l.index):null,u()}async function P(l){typeof l=="number"&&(S.text=`正在加载第${l}页...`,s.current=l,h.value=!0,u())}function F(l="batch",g){l=="single"?g.id&&Y.confirm("确认审核通过？","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then(async()=>{const p=[g.id];(await K({idList:p})).code==0&&(V("审核友链成功",{type:"success"}),u())}):l=="batch"&&(v.value.length?Y.confirm("确认审核通过？","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then(async()=>{const p=v.value.map(x=>x.id);(await K({idList:p})).code==0&&(V("批量审核友链成功",{type:"success"}),u())}):V("请先选择友链",{type:"warning"}))}function H(){v.value.length?Y.confirm("确认删除？","提示",{confirmButtonText:"确认",cancelButtonText:"取消"}).then(async()=>{const l=v.value.map(p=>p.id);(await ze({idList:l})).code==0&&(V("批量删除友链成功",{type:"success"}),u())}):V("请先选择友链",{type:"warning"})}function R(){Object.assign(i,T),y.value=!1}const J=l=>{Object.assign(i,l),l.site_avatar&&(i.avatarList=[{id:1,url:l.site_avatar}]),y.value=!0};async function o(l){l&&await l.validate(async g=>{if(g){if(i.avatarList.length)if(i.avatarList[0].id)i.site_avatar=i.avatarList[0].url;else{const m=de.service({fullscreen:!0,text:"图片上传中"}),x=await ue(i.avatarList[0]);if(x.code==0){const{url:f}=x.result;i.site_avatar=f}m.close()}else i.site_avatar="";(await we(i)).code==0&&(V("修改成功",{type:"success"}),y.value=!1,M(l),Object.assign(i,T),u())}})}async function u(){const l=await Ve(s);l.code==0&&(_.value=l.result.list,L.total=l.result.total),h.value=!1}return pe(()=>{u()}),{form:i,rules:D,param:s,loading:h,columns:C,linksTab:b,dataList:_,tableSize:A,pagination:L,loadingConfig:S,dialogVisible:y,closeDialog:R,submitForm:o,onSearch:U,tabChange:N,resetParam:O,resetForm:M,onSizeChange:I,onCurrentChange:P,editLinks:J,approveBatch:F,deleteBatch:H,handleSelectionChange:j,getPageLinksList:u}}const Q={width:1024,height:1024,body:'<path fill="currentColor" d="M280.768 753.728L691.456 167.04a32 32 0 1 1 52.416 36.672L314.24 817.472a32 32 0 0 1-45.44 7.296l-230.4-172.8a32 32 0 0 1 38.4-51.2l203.968 152.96zM736 448a32 32 0 1 1 0-64h192a32 32 0 1 1 0 64H736zM608 640a32 32 0 0 1 0-64h319.936a32 32 0 1 1 0 64H608zM480 832a32 32 0 1 1 0-64h447.936a32 32 0 1 1 0 64H480z"/>'},Te=s=>(be("data-v-6eff2665"),s=s(),he(),s),Ue=Te(()=>Z("div",{class:"card-header"},"友链管理",-1)),Me=me({__name:"index",setup(s){const b=z(),{form:c,rules:y,param:_,loading:h,columns:A,dataList:v,tableSize:C,pagination:i,linksTab:T,loadingConfig:D,dialogVisible:L,closeDialog:S,submitForm:U,onSearch:O,tabChange:M,resetParam:j,onSizeChange:I,onCurrentChange:N,editLinks:P,approveBatch:F,deleteBatch:H,handleSelectionChange:R}=Be();return(J,o)=>{const u=r("el-radio-button"),l=r("el-radio-group"),g=r("el-space"),p=r("el-input"),m=r("el-form-item"),x=r("el-date-picker"),f=r("el-button"),W=r("el-form"),ee=r("el-tooltip"),te=r("el-tab-pane"),ae=r("el-tabs"),le=r("el-avatar"),ne=r("el-tag"),oe=r("pure-table"),se=r("el-dialog"),ie=r("el-card");return B(),$(ie,{shadow:"never",class:"card"},{header:t(()=>[Ue]),default:t(()=>[a(g,{class:"float-right mb-4"},{default:t(()=>[a(l,{modelValue:e(C),"onUpdate:modelValue":o[0]||(o[0]=n=>X(C)?C.value=n:null),size:"small"},{default:t(()=>[a(u,{label:"large"},{default:t(()=>[d("大")]),_:1}),a(u,{label:"default"},{default:t(()=>[d("中")]),_:1}),a(u,{label:"small"},{default:t(()=>[d("小")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(W,{inline:!0,model:e(_),class:"bg-bg_color w-[99/100]"},{default:t(()=>[a(m,{label:"网站名称：",prop:"username"},{default:t(()=>[a(p,{modelValue:e(_).site_name,"onUpdate:modelValue":o[1]||(o[1]=n=>e(_).site_name=n),placeholder:"请输入网站名称",clearable:""},null,8,["modelValue"])]),_:1}),a(m,{label:"申请时间：",prop:"username"},{default:t(()=>[a(x,{modelValue:e(_).time,"onUpdate:modelValue":o[2]||(o[2]=n=>e(_).time=n),type:"daterange",placeholder:"请选择申请时间段","range-separator":"到","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),a(m,null,{default:t(()=>[a(f,{type:"primary",icon:e(w)(e(ve)),loading:e(h),onClick:e(O)},{default:t(()=>[d(" 搜索 ")]),_:1},8,["icon","loading","onClick"]),a(f,{icon:e(w)(e(ke)),onClick:e(j)},{default:t(()=>[d(" 重置 ")]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["model"]),a(g,{class:"mb-4 w-[100%] flex items-center"},{default:t(()=>[a(f,{type:"danger",size:"small",icon:e(w)(e(ye)),onClick:e(H)},{default:t(()=>[d("批量删除")]),_:1},8,["icon","onClick"]),e(_).status!=2?(B(),$(f,{key:0,class:"reset-margin",type:"primary",size:"small",icon:e(w)(e(Q)),onClick:o[3]||(o[3]=n=>e(F)("batch"))},{default:t(()=>[d("批量审核")]),_:1},8,["icon"])):G("",!0)]),_:1}),a(ae,{onTabClick:e(M)},{default:t(()=>[(B(!0),fe(ge,null,_e(e(T),n=>(B(),$(te,{key:n.key,lazy:!0},{label:t(()=>[a(ee,{content:n.content,placement:"top-end"},{default:t(()=>[Z("span",null,E(n.title),1)]),_:2},1032,["content"])]),_:2},1024))),128))]),_:1},8,["onTabClick"]),a(oe,{border:"","row-key":"id",alignWhole:"center",showOverflowTooltip:"",size:e(C),loading:e(h),"loading-config":e(D),height:"calc(100vh - 400px)",data:e(v),columns:e(A),pagination:e(i),onSizeChange:e(I),onCurrentChange:e(N),onSelectionChange:e(R)},{site_avatar:t(({row:n})=>[a(le,{src:n.site_avatar||n.url+"/favicon.ico"},{default:t(()=>[d(E(n.site_name),1)]),_:2},1032,["src"])]),status:t(({row:n})=>[a(ne,{type:n.status==1?"warning":"success"},{default:t(()=>[d(E(n.status==1?"待审核":"审核通过"),1)]),_:2},1032,["type"])]),operation:t(({row:n})=>[a(f,{class:"reset-margin",link:"",type:"primary",size:"small",onClick:re=>e(P)(n),icon:e(w)(e(Ce))},{default:t(()=>[d(" 修改 ")]),_:2},1032,["onClick","icon"]),n.status==1?(B(),$(f,{key:0,class:"reset-margin",link:"",type:"success",size:"small",onClick:re=>e(F)("single",n),icon:e(w)(e(Q))},{default:t(()=>[d(" 通过 ")]),_:2},1032,["onClick","icon"])):G("",!0)]),_:1},8,["size","loading","loading-config","data","columns","pagination","onSizeChange","onCurrentChange","onSelectionChange"]),a(se,{title:"修改友链",modelValue:e(L),"onUpdate:modelValue":o[9]||(o[9]=n=>X(L)?L.value=n:null),width:480,draggable:"","before-close":e(S)},{footer:t(()=>[a(f,{onClick:e(S)},{default:t(()=>[d("取消")]),_:1},8,["onClick"]),a(f,{type:"primary",onClick:o[8]||(o[8]=n=>e(U)(b.value))},{default:t(()=>[d(" 确定 ")]),_:1})]),default:t(()=>[a(W,{ref_key:"linksFormRef",ref:b,model:e(c),rules:e(y),"label-width":"100px"},{default:t(()=>[a(m,{label:"网站名称",prop:"site_name"},{default:t(()=>[a(p,{modelValue:e(c).site_name,"onUpdate:modelValue":o[4]||(o[4]=n=>e(c).site_name=n),style:{width:"380px"},placeholder:"请输入网站名称",clearable:""},null,8,["modelValue"])]),_:1}),a(m,{label:"网站描述",prop:"site_desc"},{default:t(()=>[a(p,{modelValue:e(c).site_desc,"onUpdate:modelValue":o[5]||(o[5]=n=>e(c).site_desc=n),style:{width:"380px"},placeholder:"请输入网站描述",clearable:""},null,8,["modelValue"])]),_:1}),a(m,{label:"网站地址",prop:"url"},{default:t(()=>[a(p,{modelValue:e(c).url,"onUpdate:modelValue":o[6]||(o[6]=n=>e(c).url=n),style:{width:"380px"},placeholder:"请输入网站地址",clearable:""},null,8,["modelValue"])]),_:1}),a(m,{class:"user-avatar",label:"网站头像",prop:"site_avatar"},{default:t(()=>[a(Le,{fileList:e(c).avatarList,"onUpdate:fileList":o[7]||(o[7]=n=>e(c).avatarList=n),width:80,height:80,limit:1},null,8,["fileList"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","before-close"])]),_:1})}}});const We=xe(Me,[["__scopeId","data-v-6eff2665"]]);export{We as default};
