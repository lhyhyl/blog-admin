import{d as j,i as O}from"./site-c95c3361.js";import{c6 as S,bA as A,c7 as q,bG as b,c8 as P,c0 as B}from"./auth-0313e5d1.js";import{E as T}from"./index-3c2da9f0.js";import{J as k,r as C,o as D,h as G,k as U,D as n,x as l,a3 as V,j as v,l as $,B as c,u as s,v as M,C as H}from"./runtime-core.esm-bundler-185e3605.js";import{U as J}from"./upload-9e7cdaea.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import"./vue-router-0b23dc16.js";function z(){const i=k({nick_name:"",avatar:"",avatarList:[]}),w=k({}),p=k({password:"",password1:"",password2:""}),u=(r,e,t)=>{e===""?t(new Error("请输入新密码")):e.length<4||e.length>16?t(new Error("密码长度应该在4-16位之间")):e==p.password?t(new Error("新密码和旧密码应该不同!")):t()},L=(r,e,t)=>{e===""?t(new Error("请再次输入密码")):e.length<4||e.length>16?t(new Error("密码长度应该在4-16位之间")):e!=p.password1?t(new Error("二次确认密码与新密码不一致!")):t()},d=k({nick_name:{required:!0,message:"请输入昵称",trigger:"blur"}}),R=k({password:[{required:!0,message:"请输入原密码",trigger:["blur"]}],password1:[{required:!0,validator:u,trigger:"blur"}],password2:[{required:!0,validator:L,trigger:"blur"}]}),f=C(!1),y=C(!1);async function h(r,e){await e.validate(async t=>{if(t)switch(r){case"info":await a(),f.value=!1;break;case"psd":y.value=!1,m();break;default:return}})}function I(r){switch(r){case"info":f.value=!0;break;case"psd":y.value=!0;break;default:return}}function x(r,e){switch(e.clearValidate(),r){case"info":f.value=!1,e.clearValidate(),Object.assign(i,w),Object.assign(w,j(i));break;case"psd":y.value=!1,e.clearValidate();break;default:return}}async function F(){var e,t,o,N;const r=await P(b().getUserId);if(r.code==0){const{avatar:g,nick_name:E}=r.result;((e=b())==null?void 0:e.getNickName)!=E&&((t=b())==null||t.SET_NICKNAME(E),B().setItem("blogCurrentUser",{nick_name:E,avatar:g})),((o=b())==null?void 0:o.getAvatar)!=g&&((N=b())==null||N.SET_AVATAR(g),B().setItem("blogCurrentUser",{nick_name:E,avatar:g})),Object.assign(i,r.result),g&&(i.avatarList=[{id:1,name:g.split("/").slice(-1),url:g}]),Object.assign(w,j(i))}}async function a(){if(i.avatarList.length&&!i.avatarList[0].id){const e=T.service({fullscreen:!0,text:"图片上传中"}),t=await O(i.avatarList[0]);if(t.code==0){const{url:o}=t.result;i.avatar=o}e.close()}i.avatarList.length||(i.avatar=""),(await S(i)).code==0&&(A("用户修改成功",{type:"success"}),F())}async function m(){var e;(await q(p)).code==0&&(A("密码修改成功，请重新登录",{type:"success"}),(e=b())==null||e.logOut())}async function _(){await F()}return D(()=>{_()}),{myInfoForm:i,myInfoRules:d,passwordForm:p,passwordRules:R,isEditMyInfo:f,isEditPassword:y,edit:I,save:h,cancel:x}}const Q={class:"flex justify-between personal-card"},W={class:"header"},X={key:0},Y={key:1},Z={class:"header"},ee={key:0},se=G({__name:"index",setup(i){const w=C(),p=C(),{myInfoForm:u,myInfoRules:L,passwordForm:d,passwordRules:R,isEditMyInfo:f,isEditPassword:y,edit:h,save:I,cancel:x}=z();return(F,a)=>{const m=V("el-button"),_=V("el-form-item"),r=V("el-input"),e=V("el-form"),t=V("el-card");return v(),U("div",Q,[n(t,{class:"left"},{header:l(()=>[$("div",W,[c(" 个人信息管理 "),s(f)?(v(),U("div",X,[n(m,{type:"info",plain:"",onClick:a[0]||(a[0]=o=>s(x)("info",w.value))},{default:l(()=>[c("取消")]),_:1}),n(m,{plain:"",type:"danger",onClick:a[1]||(a[1]=o=>s(I)("info",w.value))},{default:l(()=>[c("保存")]),_:1})])):(v(),M(m,{key:1,type:"primary",plain:"",onClick:a[2]||(a[2]=o=>s(h)("info"))},{default:l(()=>[c("编辑")]),_:1}))])]),default:l(()=>[n(e,{"label-width":"100",ref_key:"myInfoFormRef",ref:w,model:s(u),rules:s(L)},{default:l(()=>[n(_,{class:"user-avatar",label:"个人头像"},{default:l(()=>[n(J,{fileList:s(u).avatarList,"onUpdate:fileList":a[3]||(a[3]=o=>s(u).avatarList=o),limit:1,width:80,height:80,preview:!s(f)},null,8,["fileList","preview"])]),_:1}),n(_,{label:"昵称",prop:"nick_name"},{default:l(()=>[s(f)?(v(),M(r,{key:0,modelValue:s(u).nick_name,"onUpdate:modelValue":a[4]||(a[4]=o=>s(u).nick_name=o),placeholder:"请输入昵称",maxlength:"20",clearable:""},null,8,["modelValue"])):(v(),U("span",Y,H(s(u).nick_name),1))]),_:1})]),_:1},8,["model","rules"])]),_:1}),n(t,{class:"right"},{header:l(()=>[$("div",Z,[c(" 密码管理 "),s(y)?(v(),U("div",ee,[n(m,{type:"info",plain:"",onClick:a[5]||(a[5]=o=>s(x)("psd",p.value))},{default:l(()=>[c("取消")]),_:1}),n(m,{plain:"",type:"danger",onClick:a[6]||(a[6]=o=>s(I)("psd",p.value))},{default:l(()=>[c("保存")]),_:1})])):(v(),M(m,{key:1,type:"primary",plain:"",onClick:a[7]||(a[7]=o=>s(h)("psd"))},{default:l(()=>[c("编辑")]),_:1}))])]),default:l(()=>[n(e,{ref_key:"passwordFormRef",ref:p,"label-width":"120",model:s(d),rules:s(R)},{default:l(()=>[n(_,{label:"原密码",prop:"password"},{default:l(()=>[n(r,{type:"password","show-password":"",modelValue:s(d).password,"onUpdate:modelValue":a[8]||(a[8]=o=>s(d).password=o),placeholder:"请输入原密码",minlength:"4",maxlength:"16",clearable:""},null,8,["modelValue"])]),_:1}),n(_,{label:"新密码",prop:"password1"},{default:l(()=>[n(r,{"show-password":"",modelValue:s(d).password1,"onUpdate:modelValue":a[9]||(a[9]=o=>s(d).password1=o),placeholder:"请输入新密码",minlength:"4",maxlength:"16",clearable:""},null,8,["modelValue"])]),_:1}),n(_,{label:"二次确认密码",prop:"password2"},{default:l(()=>[n(r,{"show-password":"",modelValue:s(d).password2,"onUpdate:modelValue":a[10]||(a[10]=o=>s(d).password2=o),placeholder:"请二次确认新密码",minlength:"4",maxlength:"16",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1})])}}});const de=K(se,[["__scopeId","data-v-05b49343"]]);export{de as default};
