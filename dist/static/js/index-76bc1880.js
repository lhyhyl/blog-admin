import{cd as K,ce as Q,bA as D,cf as X}from"./auth-0313e5d1.js";import{i as Y}from"./site-c95c3361.js";import{E as Z}from"./index-3c2da9f0.js";import{J as _,r as x,o as E,h as ee,v as ae,x as l,a3 as i,j as te,D as a,u as e,e as M,B as m,ba as le,b9 as oe,l as ne}from"./runtime-core.esm-bundler-185e3605.js";import{u as B}from"./hooks-e73aa1dd.js";import{d as se}from"./search-cc37b371.js";import{d as ie}from"./refresh-04c5340d.js";import{d as re}from"./edit-pen-37b5ced2.js";import{U as ce}from"./upload-9e7cdaea.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";import"./vue-router-0b23dc16.js";import"./index-6d140db2.js";function ue(){const r=_({current:1,size:10,nick_name:"",role:null}),y=_({...r}),u=x([]),c=x(!1),w=x("small"),R=[{label:"序号",type:"index",width:55},{label:"用户名",prop:"username",minWidth:100},{label:"用户昵称",prop:"nick_name",minWidth:120},{label:"头像",prop:"avatar",minWidth:100,slot:"avatar"},{label:"角色",prop:"role",minWidth:180,slot:"role"},{label:"IP",prop:"ip_address",minWidth:180},{label:"创建日期",prop:"createdAt"},{label:"修改日期",prop:"updatedAt"},{label:"操作",fixed:"right",width:80,slot:"operation"}],n=_({id:"",nick_name:"",avatar:"",avatarList:[]}),L=_({...n}),g=_({nick_name:[{required:!0,message:"请输入昵称",trigger:"blur"}]}),v=x(!1),b=_({pageSize:10,currentPage:1,pageSizes:[10,15,20],total:0,align:"right",background:!0,small:!0}),V=_({text:"正在加载第1页...",viewBox:"-10, -10, 50, 50",spinner:`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `});function U(){d()}const F=()=>{Object.assign(r,y),U()};function I(t){r.size=t,d()}async function P(t){typeof t=="number"&&(V.text=`正在加载第${t}页...`,r.current=t,c.value=!0,d())}async function d(){const t=await K(r);t.code==0&&(u.value=t.result.list,b.total=t.result.total),c.value=!1}async function z(t){const{id:h,role:C}=t;(await Q(h,C==1?2:1)).code==0&&(D("修改用户角色成功",{type:"success"}),d())}const W=t=>{Object.assign(n,t),t.avatar&&(n.avatarList=[{id:1,url:t.avatar}]),v.value=!0},$=t=>{t&&t.resetFields()};function O(){Object.assign(n,L),v.value=!1}async function s(t){t&&await t.validate(async h=>{if(h){if(n.avatarList.length)if(n.avatarList[0].id)n.avatar=n.avatarList[0].url;else{const A=Z.service({fullscreen:!0,text:"图片上传中"}),p=await Y(n.avatarList[0]);if(p.code==0){const{url:S}=p.result;n.avatar=S}A.close()}else n.avatar="";const{id:C,nick_name:k,avatar:f}=n;(await X({id:C,nick_name:k,avatar:f})).code==0&&(D("修改成功",{type:"success"}),v.value=!1,$(t),Object.assign(n,L),d())}})}return E(()=>{d()}),{form:n,param:r,loading:c,columns:R,dataList:u,formRules:g,tableSize:w,pagination:b,dialogVisible:v,loadingConfig:V,onSearch:U,editUser:W,changeRole:z,submitForm:s,resetParam:F,closeDialog:O,onSizeChange:I,onCurrentChange:P,getPageUserList:d}}const pe=r=>(le("data-v-955f4266"),r=r(),oe(),r),me=pe(()=>ne("div",{class:"card-header"},"用户管理",-1)),fe=ee({__name:"index",setup(r){const y=x(null),{form:u,param:c,loading:w,columns:R,dataList:n,formRules:L,tableSize:g,pagination:v,dialogVisible:b,loadingConfig:V,onSearch:U,editUser:F,changeRole:I,submitForm:P,resetParam:d,closeDialog:z,onSizeChange:W,onCurrentChange:$}=ue();return(O,s)=>{const t=i("el-radio-button"),h=i("el-radio-group"),C=i("el-space"),k=i("el-input"),f=i("el-form-item"),j=i("el-option"),A=i("el-select"),p=i("el-button"),S=i("el-form"),N=i("el-avatar"),T=i("el-switch"),q=i("pure-table"),J=i("el-dialog"),G=i("el-card");return te(),ae(G,{shadow:"never",class:"card"},{header:l(()=>[me]),default:l(()=>[a(C,{class:"float-right mb-4"},{default:l(()=>[a(h,{modelValue:e(g),"onUpdate:modelValue":s[0]||(s[0]=o=>M(g)?g.value=o:null),size:"small"},{default:l(()=>[a(t,{label:"large"},{default:l(()=>[m("大")]),_:1}),a(t,{label:"default"},{default:l(()=>[m("中")]),_:1}),a(t,{label:"small"},{default:l(()=>[m("小")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(S,{inline:!0,model:e(c),class:"bg-bg_color w-[99/100]"},{default:l(()=>[a(f,{label:"用户昵称：",prop:"nick_name"},{default:l(()=>[a(k,{modelValue:e(c).nick_name,"onUpdate:modelValue":s[1]||(s[1]=o=>e(c).nick_name=o),placeholder:"请输入用户昵称",clearable:"",class:"!w-[180px]"},null,8,["modelValue"])]),_:1}),a(f,{label:"用户角色：",prop:"nick_name"},{default:l(()=>[a(A,{modelValue:e(c).role,"onUpdate:modelValue":s[2]||(s[2]=o=>e(c).role=o),placeholder:"选择用户角色",clearable:"",class:"!w-[180px]"},{default:l(()=>[a(j,{label:"管理员",value:1}),a(j,{label:"普通用户",value:2})]),_:1},8,["modelValue"])]),_:1}),a(f,null,{default:l(()=>[a(p,{type:"primary",icon:e(B)(e(se)),loading:e(w),onClick:e(U)},{default:l(()=>[m(" 搜索 ")]),_:1},8,["icon","loading","onClick"]),a(p,{icon:e(B)(e(ie)),onClick:e(d)},{default:l(()=>[m(" 重置 ")]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["model"]),a(q,{border:"","row-key":"id",alignWhole:"center",showOverflowTooltip:"",size:e(g),loading:e(w),"loading-config":e(V),height:"calc(100vh - 300px)",data:e(n),columns:e(R),pagination:e(v),onSizeChange:e(W),onCurrentChange:e($)},{avatar:l(({row:o})=>[a(N,{size:45,src:o.avatar||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"},null,8,["src"])]),role:l(({row:o})=>[a(T,{value:o.role,"active-value":1,"inactive-value":2,"active-text":"管理员","inactive-text":"普通用户",onChange:H=>e(I)(o)},null,8,["value","onChange"])]),operation:l(({row:o})=>[a(p,{class:"reset-margin",link:"",type:"primary",size:"small",icon:e(B)(e(re)),onClick:H=>e(F)(o)},{default:l(()=>[m(" 修改 ")]),_:2},1032,["icon","onClick"])]),_:1},8,["size","loading","loading-config","data","columns","pagination","onSizeChange","onCurrentChange"]),a(J,{title:"编辑用户",modelValue:e(b),"onUpdate:modelValue":s[6]||(s[6]=o=>M(b)?b.value=o:null),width:480,draggable:"","before-close":e(z)},{footer:l(()=>[a(p,{onClick:e(z)},{default:l(()=>[m("取消")]),_:1},8,["onClick"]),a(p,{type:"primary",onClick:s[5]||(s[5]=o=>e(P)(y.value))},{default:l(()=>[m(" 确定 ")]),_:1})]),default:l(()=>[a(S,{ref_key:"userFormRef",ref:y,model:e(u),rules:e(L),"label-width":"100px"},{default:l(()=>[a(f,{label:"昵称",prop:"nick_name"},{default:l(()=>[a(k,{modelValue:e(u).nick_name,"onUpdate:modelValue":s[3]||(s[3]=o=>e(u).nick_name=o),style:{width:"380px"},placeholder:"请输入用户昵称",clearable:""},null,8,["modelValue"])]),_:1}),a(f,{class:"user-avatar",label:"头像"},{default:l(()=>[a(ce,{fileList:e(u).avatarList,"onUpdate:fileList":s[4]||(s[4]=o=>e(u).avatarList=o),width:80,height:80,limit:1},null,8,["fileList"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","before-close"])]),_:1})}}});const Ue=de(fe,[["__scopeId","data-v-955f4266"]]);export{Ue as default};
