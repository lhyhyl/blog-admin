import{bo as F,aF as W,bA as B,bO as Y,ca as Z,b6 as ee}from"./auth-0313e5d1.js";import{U as ae}from"./upload-9e7cdaea.js";import{i as le}from"./site-c95c3361.js";import{E as te}from"./index-3c2da9f0.js";import{h as se,r as g,J as w,o as oe,v as H,x as o,a3 as n,j as m,l as d,B as p,D as s,u as C,k as $,X as j,F as z,C as O,ba as re,b9 as ne}from"./runtime-core.esm-bundler-185e3605.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";import"./vue-router-0b23dc16.js";const ie=i=>F.request("get","/api/pageHeader/getAll",{data:i}),ce=i=>F.request("post","/api/pageHeader/addOrUpdate",{data:i}),ue=i=>F.request("post","/api/pageHeader/delete",{data:i}),V=[{label:"时间轴",value:"Archives",disabled:!1},{label:"前端",value:"Front",disabled:!1},{label:"后端",value:"Back",disabled:!1},{label:"网站列表",value:"SiteList",disabled:!1},{label:"友链",value:"LinkList",disabled:!1},{label:"申请友链",value:"LinkApply",disabled:!1},{label:"修改友链",value:"LinkUpdate",disabled:!1},{label:"分类",value:"Category",disabled:!1},{label:"标签",value:"Tag",disabled:!1},{label:"相册",value:"PhotoAlbum",disabled:!1},{label:"说说",value:"Talk",disabled:!1},{label:"登录",value:"Login",disabled:!1},{label:"注册",value:"Register",disabled:!1},{label:"用户中心",value:"UserCenter",disabled:!1}],U=i=>(re("data-v-99069ca1"),i=i(),ne(),i),_e={class:"flex_r_b"},pe=U(()=>d("div",{class:"tip"},[p(" 背景管理用于博客前台管理每个页面的头部背景图 "),d("br"),p(" 路由名称就是当前页面的route.name,背景列表是维护在这个页面的routerList.js里的,需要添加路由自己行在js里添加 ")],-1)),me={class:"page-header-card"},fe={class:"pad5"},ge={class:"operate flex_r_e"},be={class:"page-header-title"},ve=U(()=>d("span",{class:"mr-[5px]"},"页面名称: ",-1)),xe=["title"],Le={class:"page-header-title"},he=U(()=>d("span",{class:"mr-[5px]"},"路由: ",-1)),ye=["title"],ke=se({__name:"index",setup(i){const q=(t,e,r)=>{if(!l.coverList.length)return new Error("请上传背景");r()},b=g([]),c=g(!1),v=g(),l=w({id:"",route_name:"",bg_url:"",page_name:"",coverList:[]}),u=g(V),I=w({...l}),A=w({route_name:{required:!0,message:"请输入路由名称",trigger:["blur"]},pageHeader_cover:{required:!0,validator:q,trigger:["change"]}}),P=()=>{v.value.resetFields(),Object.assign(l,I),c.value=!1},N=async t=>{t&&await t.validate(async e=>{if(e){if(l.coverList[0].id)l.bg_url=l.coverList[0].url;else{const _=te.service({fullscreen:!0,text:"图片上传中"}),f=await le(l.coverList[0]);if(f.code==0){const{url:h}=f.result;l.bg_url=h}_.close()}(await ce(l)).code==0&&(await L(),B(`${l.id?"修改":"新增"}成功`,{type:"success"}),t.resetFields(),Object.assign(l,I),c.value=!1)}})},x=(t,e)=>{switch(t){case"edit":Object.assign(l,Y(e)),c.value=!0;break;case"delete":R(e.id,e.bg_url);break;case"add":c.value=!0;break;default:return}},R=async(t,e)=>{(await ue({id:t,url:e})).code==0&&(L(),B("删除成功",{type:"success"}))},S=t=>{const e=V.findIndex(r=>r.value==t);if(e!=-1)return V[e].label},D=t=>{if(t){const e=u.value.findIndex(r=>r.value==t);e!=-1&&(u.value[e].disabled=!0)}else{const e=u.value.findIndex(r=>r.value==l.route_name);e!=-1&&(u.value[e].disabled=!1)}l.route_name=t},L=async()=>{const t=await ie();t.code==0&&(b.value=t.result.map(e=>({id:e.id,route_name:e.route_name,page_name:S(e.route_name),bg_url:e.bg_url,coverList:[{id:1,url:e.bg_url}]})),u.value.forEach(e=>{b.value.findIndex(_=>_.route_name==e.value)!=-1?e.disabled=!0:e.disabled=!1}))};return oe(()=>{L()}),(t,e)=>{const r=n("el-button"),_=n("el-icon"),f=n("el-popconfirm"),h=n("el-image"),E=n("el-col"),T=n("el-row"),G=n("el-option"),J=n("el-select"),y=n("el-form-item"),M=n("el-input"),X=n("el-form"),K=n("el-dialog"),Q=n("el-card");return m(),H(Q,null,{header:o(()=>[d("div",_e,[p(" 背景管理 "),s(r,{type:"primary",icon:C(W),size:"small",onClick:e[0]||(e[0]=a=>x("add"))},{default:o(()=>[p("新增")]),_:1},8,["icon"])]),pe]),default:o(()=>[s(T,{class:"page-header"},{default:o(()=>[(m(!0),$(z,null,j(b.value,a=>(m(),H(E,{style:{padding:"10px"},xs:24,sm:12,md:6,key:a.id},{default:o(()=>[d("div",me,[d("div",fe,[d("div",ge,[s(_,{color:"#66b1ff",size:"18",onClick:k=>x("edit",a)},{default:o(()=>[s(C(Z))]),_:2},1032,["onClick"]),s(f,{title:`删除背景-${a.route_name}?`,"icon-color":"#66b1ff",onConfirm:k=>x("delete",a)},{reference:o(()=>[s(_,{color:"#f56c6c",size:"16",style:{"margin-left":"5px"}},{default:o(()=>[s(C(ee))]),_:1})]),_:2},1032,["title","onConfirm"])]),d("div",be,[ve,d("span",{title:a.page_name},O(a.page_name),9,xe)]),d("div",Le,[he,d("span",{title:a.route_name},O(a.route_name),9,ye)])]),s(h,{class:"page-header-image animate__animated animate__fadeIn",src:a.bg_url,fit:"cover",loading:"lazy","preview-teleported":"","preview-src-list":a.coverList.map(k=>k.url)},null,8,["src","preview-src-list"])])]),_:2},1024))),128))]),_:1}),s(K,{title:l.id?"编辑背景":"新增背景",modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=a=>c.value=a),width:400,"before-close":P},{footer:o(()=>[s(r,{size:"small",onClick:e[4]||(e[4]=a=>P())},{default:o(()=>[p("取消")]),_:1}),s(r,{size:"small",type:"danger",plain:"",onClick:e[5]||(e[5]=a=>N(v.value))},{default:o(()=>[p(" 保存 ")]),_:1})]),default:o(()=>[s(X,{ref_key:"pageHeaderFormRef",ref:v,inline:!0,model:l,rules:A,class:"bg-bg_color w-[99/100]","label-width":"100"},{default:o(()=>[s(y,{class:"form-item80",label:"页面名称"},{default:o(()=>[s(J,{modelValue:l.page_name,"onUpdate:modelValue":e[1]||(e[1]=a=>l.page_name=a),placeholder:"请选择页面名称",clearable:"",maxlength:"25",onChange:D},{default:o(()=>[(m(!0),$(z,null,j(u.value,a=>(m(),H(G,{key:a.value,label:a.label,value:a.value,disabled:a.disabled},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(y,{class:"form-item80",label:"路由",prop:"route_name"},{default:o(()=>[s(M,{modelValue:l.route_name,"onUpdate:modelValue":e[2]||(e[2]=a=>l.route_name=a),placeholder:"请输入路由",clearable:"",maxlength:"25",disabled:""},null,8,["modelValue"])]),_:1}),s(y,{class:"cover",label:"背景图",prop:"pageHeader_cover"},{default:o(()=>[s(ae,{fileList:l.coverList,"onUpdate:fileList":e[3]||(e[3]=a=>l.coverList=a),width:200,height:200,limit:1},null,8,["fileList"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])]),_:1})}}});const Pe=de(ke,[["__scopeId","data-v-99069ca1"]]);export{Pe as default};
